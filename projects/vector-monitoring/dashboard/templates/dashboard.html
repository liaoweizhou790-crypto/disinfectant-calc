<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç—…åª’ç”Ÿç‰©ç›‘æµ‹æ•°æ®çœ‹æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        .card-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .card-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        .card-label {
            color: #666;
            font-size: 14px;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .section-title {
            font-size: 22px;
            font-weight: 600;
            margin: 40px 0 20px;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #999;
        }
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¦Ÿ ç—…åª’ç”Ÿç‰©ç›‘æµ‹æ•°æ®çœ‹æ¿</h1>
        <p>å®æ—¶ç›‘æµ‹æ•°æ®åˆ†æä¸å¯è§†åŒ–</p>
    </div>

    <div class="container">
        <!-- æ±‡æ€»å¡ç‰‡ -->
        <div class="summary-cards" id="summaryCards">
            <div class="card">
                <div class="card-icon">ğŸ­</div>
                <div class="card-value" id="rodentCount">-</div>
                <div class="card-label">é¼ å¯†åº¦ç›‘æµ‹</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ¦Ÿ</div>
                <div class="card-value" id="mosquitoCount">-</div>
                <div class="card-label">èšŠå¯†åº¦ç›‘æµ‹</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸª°</div>
                <div class="card-value" id="flyCount">-</div>
                <div class="card-label">è‡å¯†åº¦ç›‘æµ‹</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸª³</div>
                <div class="card-value" id="cockroachCount">-</div>
                <div class="card-label">èŸ‘å¯†åº¦ç›‘æµ‹</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ•·ï¸</div>
                <div class="card-value" id="tickCount">-</div>
                <div class="card-label">èœ±è™«ç›‘æµ‹</div>
            </div>
            <div class="card">
                <div class="card-icon">ğŸ“</div>
                <div class="card-value" id="pointCount">-</div>
                <div class="card-label">ç›‘æµ‹ç‚¹ä½</div>
            </div>
        </div>

        <h2 class="section-title">ğŸ­ é¼ å¯†åº¦ç›‘æµ‹</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <div class="chart-title">æ•è·æ•°é‡è¶‹åŠ¿</div>
                <div class="chart-wrapper">
                    <canvas id="rodentTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">æ•è·ç‡å˜åŒ–</div>
                <div class="chart-wrapper">
                    <canvas id="rodentRateChart"></canvas>
                </div>
            </div>
        </div>

        <h2 class="section-title">ğŸ¦Ÿ èšŠå¯†åº¦ç›‘æµ‹</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <div class="chart-title">èšŠè™«ç§ç±»åˆ†å¸ƒ</div>
                <div class="chart-wrapper">
                    <canvas id="mosquitoTypeChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">èšŠå¯†åº¦è¶‹åŠ¿</div>
                <div class="chart-wrapper">
                    <canvas id="mosquitoTrendChart"></canvas>
                </div>
            </div>
        </div>

        <h2 class="section-title">ğŸª° è‡å¯†åº¦ç›‘æµ‹</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <div class="chart-title">è‡ç±»ç§ç±»åˆ†å¸ƒ</div>
                <div class="chart-wrapper">
                    <canvas id="flyTypeChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">è‡å¯†åº¦è¶‹åŠ¿</div>
                <div class="chart-wrapper">
                    <canvas id="flyTrendChart"></canvas>
                </div>
            </div>
        </div>

        <h2 class="section-title">ğŸª³ èŸ‘å¯†åº¦ç›‘æµ‹</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <div class="chart-title">èŸ‘è‚æ•è·è¶‹åŠ¿</div>
                <div class="chart-wrapper">
                    <canvas id="cockroachTrendChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">é˜³æ€§ç‡å˜åŒ–</div>
                <div class="chart-wrapper">
                    <canvas id="cockroachRateChart"></canvas>
                </div>
            </div>
        </div>

        <h2 class="section-title">ğŸ•·ï¸ èœ±è™«ç›‘æµ‹</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <div class="chart-title">èœ±è™«ç§ç±»åˆ†å¸ƒ</div>
                <div class="chart-wrapper">
                    <canvas id="tickTypeChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">èœ±è™«ç›‘æµ‹è¶‹åŠ¿</div>
                <div class="chart-wrapper">
                    <canvas id="tickTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å›¾è¡¨é…ç½®
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
        Chart.defaults.color = '#666';

        // é¢œè‰²é…ç½®
        const colors = {
            primary: '#667eea',
            secondary: '#764ba2',
            success: '#48bb78',
            warning: '#ed8936',
            danger: '#f56565',
            info: '#4299e1'
        };

        // åŠ è½½æ±‡æ€»æ•°æ®
        async function loadSummary() {
            try {
                const response = await fetch('/api/summary');
                const data = await response.json();
                document.getElementById('rodentCount').textContent = data['é¼ å¯†åº¦'] || 0;
                document.getElementById('mosquitoCount').textContent = data['èšŠå¯†åº¦'] || 0;
                document.getElementById('flyCount').textContent = data['è‡å¯†åº¦'] || 0;
                document.getElementById('cockroachCount').textContent = data['èŸ‘å¯†åº¦'] || 0;
                document.getElementById('tickCount').textContent = data['èœ±è™«ç›‘æµ‹'] || 0;
                document.getElementById('pointCount').textContent = data['ç›‘æµ‹ç‚¹ä½'] || 0;
            } catch (error) {
                console.error('åŠ è½½æ±‡æ€»æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½é¼ å¯†åº¦æ•°æ®
        async function loadRodentData() {
            try {
                const response = await fetch('/api/rodent-stats');
                const data = await response.json();

                // æ•è·æ•°é‡è¶‹åŠ¿
                new Chart(document.getElementById('rodentTrendChart'), {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'æ•è·æ€»æ•°',
                            data: data.totals,
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });

                // æ•è·ç‡å˜åŒ–
                new Chart(document.getElementById('rodentRateChart'), {
                    type: 'bar',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'æ•è·ç‡(%)',
                            data: data.rates,
                            backgroundColor: colors.warning
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('åŠ è½½é¼ å¯†åº¦æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½èšŠå¯†åº¦æ•°æ®
        async function loadMosquitoData() {
            try {
                const response = await fetch('/api/mosquito-stats');
                const data = await response.json();

                // èšŠè™«ç§ç±»åˆ†å¸ƒ
                const totalPipiens = data.culex_pipiens.reduce((a, b) => a + b, 0);
                const totalQuinque = data.culex_quinquefasciatus.reduce((a, b) => a + b, 0);
                const totalAlbo = data.aedes_albopictus.reduce((a, b) => a + b, 0);

                new Chart(document.getElementById('mosquitoTypeChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['æ·¡è‰²åº“èšŠ', 'è‡´å€¦åº“èšŠ', 'ç™½çº¹ä¼ŠèšŠ'],
                        datasets: [{
                            data: [totalPipiens, totalQuinque, totalAlbo],
                            backgroundColor: [colors.primary, colors.secondary, colors.success]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // èšŠå¯†åº¦è¶‹åŠ¿
                new Chart(document.getElementById('mosquitoTrendChart'), {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'èšŠè™«æ€»æ•°',
                            data: data.totals,
                            borderColor: colors.primary,
                            backgroundColor: colors.primary + '20',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('åŠ è½½èšŠå¯†åº¦æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½è‡å¯†åº¦æ•°æ®
        async function loadFlyData() {
            try {
                const response = await fetch('/api/fly-stats');
                const data = await response.json();

                // è‡ç±»ç§ç±»åˆ†å¸ƒ
                const totalHouse = data.house_fly.reduce((a, b) => a + b, 0);
                const totalChrysomya = data.chrysomya.reduce((a, b) => a + b, 0);
                const totalLucilia = data.lucilia.reduce((a, b) => a + b, 0);

                new Chart(document.getElementById('flyTypeChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['å®¶è‡', 'å¤§å¤´é‡‘è‡', 'ä¸å…‰ç»¿è‡'],
                        datasets: [{
                            data: [totalHouse, totalChrysomya, totalLucilia],
                            backgroundColor: [colors.warning, colors.danger, colors.info]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // è‡å¯†åº¦è¶‹åŠ¿
                new Chart(document.getElementById('flyTrendChart'), {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'è‡ç±»æ€»æ•°',
                            data: data.totals,
                            borderColor: colors.warning,
                            backgroundColor: colors.warning + '20',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('åŠ è½½è‡å¯†åº¦æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½èŸ‘å¯†åº¦æ•°æ®
        async function loadCockroachData() {
            try {
                const response = await fetch('/api/cockroach-stats');
                const data = await response.json();

                // èŸ‘è‚æ•è·è¶‹åŠ¿
                new Chart(document.getElementById('cockroachTrendChart'), {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'æ•è·æ€»æ•°',
                            data: data.totals,
                            borderColor: colors.danger,
                            backgroundColor: colors.danger + '20',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });

                // é˜³æ€§ç‡å˜åŒ–
                new Chart(document.getElementById('cockroachRateChart'), {
                    type: 'bar',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'é˜³æ€§ç‡(%)',
                            data: data.positive_rates,
                            backgroundColor: colors.danger
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('åŠ è½½èŸ‘å¯†åº¦æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½èœ±è™«æ•°æ®
        async function loadTickData() {
            try {
                const response = await fetch('/api/tick-stats');
                const data = await response.json();

                // èœ±è™«ç§ç±»åˆ†å¸ƒ
                const totalLongi = data.longicornis.reduce((a, b) => a + b, 0);
                const totalSilvarum = data.silvarum.reduce((a, b) => a + b, 0);

                new Chart(document.getElementById('tickTypeChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['é•¿è§’è¡€èœ±', 'æ£®æ—é©èœ±'],
                        datasets: [{
                            data: [totalLongi, totalSilvarum],
                            backgroundColor: [colors.secondary, colors.info]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // èœ±è™«ç›‘æµ‹è¶‹åŠ¿
                new Chart(document.getElementById('tickTrendChart'), {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [{
                            label: 'èœ±è™«æ€»æ•°',
                            data: data.totals,
                            borderColor: colors.secondary,
                            backgroundColor: colors.secondary + '20',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            } catch (error) {
                console.error('åŠ è½½èœ±è™«æ•°æ®å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadSummary();
            loadRodentData();
            loadMosquitoData();
            loadFlyData();
            loadCockroachData();
            loadTickData();
        });
    </script>
</body>
</html>
